import{urlProductos,arrayCategorias,recuperarCarrito,crearCategoriaHTML,crearMensajeErrorCategorias,crearCardHTML,guardarCarrito,crearCardErrorHTML,mostrarMensaje}from"./utils.min.js";const productos=[],carrito=recuperarCarrito(),divContainer=document.querySelector("#container"),divCategories=document.querySelector("#categories"),btnCheckout=document.querySelector("#botonCheckout"),inputSearch=document.querySelector("#inputSearch"),arrowUp=document.querySelector("div#arrow-up");function cargarCategorias(){arrayCategorias.length>0?arrayCategorias.forEach((r=>{const e=document.createElement("span");e.innerText=r,e.classList.add("category"),e.addEventListener("click",(()=>{if("Todos"===r)cargarProductos(productos);else{cargarProductos(productos.filter((e=>e.categoria===r)))}})),divCategories.appendChild(e)})):divCategories.innerHTML=crearMensajeErrorCategorias()}async function obtenerProductos(){try{const r=await fetch(urlProductos);if(200!==r.status)throw new Error("Error al obtener los productos.");{const e=await r.json();productos.push(...e),cargarProductosPorCategoria(productos)}}catch(r){divContainer.innerHTML=crearCardErrorHTML()}}function cargarProductosPorCategoria(r){divCategories.classList.add("hide-arrow");const e=Object.groupBy(r,(r=>r.categoria));divContainer.innerHTML="";for(let r in e)divContainer.innerHTML+=crearCategoriaHTML(r),e[r].forEach((r=>{divContainer.innerHTML+=crearCardHTML(r)}))}function cargarProductos(r){r.length>0&&(divContainer.innerHTML="",r.forEach((r=>divContainer.innerHTML+=crearCardHTML(r))),activarClicksBtnComprar())}function aplicarAnimacionEnCheckout(){btnCheckout.classList.add("girar-trompo"),btnCheckout.addEventListener("animationend",(()=>btnCheckout.classList.remove("girar-trompo")))}function activarClicksBtnComprar(){const r=document.querySelectorAll("button#buttonComprar");r.length>0&&r.forEach((r=>{r.addEventListener("click",(()=>{let e=productos.find((e=>e.id===r.dataset.codigo));carrito.push(e),guardarCarrito(carrito),mostrarMensaje(`'${e.nombre}' agregado.`,"success",2500),aplicarAnimacionEnCheckout()}))}))}cargarCategorias(),obtenerProductos(),btnCheckout.addEventListener("click",(()=>{carrito.length>0?location.href="checkout.html":mostrarMensaje("Carga al menos un producto en el carrito.","alert",2500)})),btnCheckout.addEventListener("mousemove",(()=>{btnCheckout.title=carrito.length>0?"Productos en carrito: "+carrito.length:"Sin productos en carrito"})),inputSearch.addEventListener("input",(r=>{""===r.target.value.trim()&&cargarProductos(productos)})),inputSearch.addEventListener("keypress",(r=>{if("Enter"===r.key&&""!==inputSearch.value.trim()){let r=inputSearch.value.trim().toLowerCase(),e=productos.filter((e=>e.nombre.toLowerCase().includes(r)));e.length>0?cargarProductos(e):mostrarMensaje("ðŸ”Ž No se encontraron resultados.","alert",3500)}})),document.addEventListener("scroll",(()=>{window.scrollY>600?arrowUp.classList.remove("hide-arrow"):arrowUp.classList.add("hide-arrow")})),arrowUp.addEventListener("click",(()=>{window.scrollTo({top:0,behavior:"smooth"})}));